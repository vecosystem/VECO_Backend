<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>OAuth2 Login Test</title>
</head>
<body>
<h1>ğŸ” Google ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</h1>

<button id="loginBtn-create">Googleë¡œ ë¡œê·¸ì¸ - ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ìƒì„±</button>
<button id="loginBtn-join">Googleë¡œ ë¡œê·¸ì¸ - ê¸°ì¡´ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì°¸ì—¬</button>
<button id="reissue">ì•¡ì„¸ìŠ¤ í† í° ë°œê¸‰</button>
<!--í…ŒìŠ¤íŠ¸ìš© ì•¡ì„¸ìŠ¤ í† í° ì…ë ¥ì°½-->
<input type="text" id="accessToken" placeholder="ì•¡ì„¸ìŠ¤ í† í°ì„ ì…ë ¥í•˜ì„¸ìš”">
<button id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>

<script>
    document.getElementById("loginBtn-create").addEventListener("click", () => {
        // êµ¬ê¸€ OAuth2 ë¡œê·¸ì¸ ì‹œì‘
        window.location.href = "/oauth2/authorization/google?flow=create";
    })

    document.getElementById("loginBtn-join").addEventListener("click", () => {
        // êµ¬ê¸€ OAuth2 ë¡œê·¸ì¸ ì‹œì‘
        window.location.href = "/oauth2/authorization/google?flow=join";
    })

    document.getElementById("reissue").addEventListener("click", () => {
        // ì•¡ì„¸ìŠ¤ í† í° ì¬ë°œê¸‰ ìš”ì²­
        fetch("/api/token/reissue", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: "include" // ì¿ í‚¤ë¥¼ í¬í•¨í•˜ì—¬ ìš”ì²­
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error("í† í° ì¬ë°œê¸‰ ì‹¤íŒ¨");
                }
            })
            .then(data => {
                console.log("ìƒˆë¡œìš´ ì•¡ì„¸ìŠ¤ í† í°:", data.result.accessToken);
                document.getElementById("accessToken").value = data.result.accessToken;
            })
            .catch(error => {
                console.error("ì—ëŸ¬ ë°œìƒ:", error);
            });
    })

    document.getElementById("logoutBtn").addEventListener("click", () => {
        // ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ /api/token/logoutìœ¼ë¡œ post ìš”ì²­
        // inputì— ì…ë ¥ëœ ì•¡ì„¸ìŠ¤ í† í°ì„ ì‚¬ìš©í•˜ì—¬ ë¡œê·¸ì•„ì›ƒ
        const accessToken = document.getElementById("accessToken").value;
        fetch("/api/token/logout", {
            method: "POST",
            headers: {
                // í—¤ë”ì— ì•¡ì„¸ìŠ¤ í† í°
                "Content-Type": "application/json",
                "Authorization": "Bearer " + accessToken
            },
            credentials: "include" // ì¿ í‚¤ë¥¼ í¬í•¨í•˜ì—¬ ìš”ì²­
        })
    })
</script>
</body>
</html>
